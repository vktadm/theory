**Регулярные выражения (Regex)** – это особые шаблоны для поиска определенных подстрок в текстовых документах и на веб-страницах.

Для работы с Regex в Python используют встроенный модуль **re**, в который входят:
- Набор функций для поиска и замены подстрок – ниже мы подробно рассмотрим примеры использования основных методов.
- Компилятор **re.compile** – он создает Regex-объекты для повторного использования и ускоряет работу регулярных выражений, как мы увидим чуть позже.

Регулярные выражения состоят из **литералов** (букв и цифр) и **метасимволов**.

## Сырые строки

Для экранирования спецсимволов применяют обратные слэши`\`, или же заключают выражение в **r**-строку .

Чтобы строка **стала «сырой»**, перед ней необходимо поставить символ `r` в любом регистре:
```python
common_string = 'C:\file.txt' # Обычная строка 
raw_string = r'C:\file.txt' # Сырая строка
```
В такой строке отключается экранирование. Это значит, что обратный слеш считается самостоятельным символом. Основное применение сырых строк – работа с регулярными выражениями.

**Комбинирование префиксов**
```python
# Используем 2 префикса одновременно (последовательность не важна):
raw_f_string = rf'C:\file.txt'
f_raw_string = fr'C:\file.txt'
```

## Экранирование в регулярных выражениях

Если нам нужно **использовать какой-то спецсимвол как простой текст**, то достаточно поставить перед ним `\`, как и в обычных строках Python.

```python
# Отключаем экранирование всей строки префиксом r:
print(r"Переносим\nстроку")
print(r"\\'")

# Отключаем экранирование каждой последовательности с помощью слешей:
print("Переносим\\nстроку")
print("\\\\'")
```

## Онлайн-сервисы для проверки регулярных выражений

Для проверки регулярных выражений существуют специальные онлайн-сервисы. Из самых удобных выделю следующие:

- [regex101](https://regex101.com/)
- [pythex](https://pythex.org/)

## Текст как регулярное выражение
```python
reg_str = r"Привет" # Регулярное выражение зависимо от регистра
```

**Пересечения**

`r"00"` в тексте `000000000000`? 

Нашлось всего лишь 6 совпадений. Это означает, что найденные совпадения не пересекаются и движок регулярных выражения ищет совпадения по порядку.

## Использование квадратных скобок []

##### Поиск указанных символов
Если необходимо найти **один** из нескольких конкретных символов (между символами будет работать правило - **ИЛИ**), можно воспользоваться синтаксисом квадратных скобок:

```python
r'[cr1]'     # Найдёт c, r, и 1
r'[cr]at'    # Найдёт слова cat и rat
r'[12]7[56]' # Найдёт 175, 176, 275, 276
r'[kr][ai][kd]' # kid, rad, kik

# От перестановки символов результат не меняется
r'[cr1]' # Найдёт c, r, и 1
r'[rc1]' # Найдёт c, r, и 1
```

##### Исключение символов
```python
r'[^12]'  # Найдёт всё, кроме 1 и 2
r'[^12]7' # Найдёт все последовательности, что заканчиваются на 7, и не начинаются на 1 и 2

# Если символ `^` не стоит в начале скобок или он экранирован - он воспринимается как обычный текст:

r'[0^]_[0^]' # Найдёт 0_0, 0_^, ^_0, ^_^ 
r'[\^0]_[\^0]' # Найдёт 0_0, 0_^, ^_0, ^_^
```

##### Диапазоны и сокращения

```python
r'[0-9]' # То же самое, что и [0123456789]
r'[a-z]' # То же самое, что и [abcdefghijklmnopqrstuvwxyz]
r'[A-Z]' # То же самое, что и [ABCDEFGHIJKLMNOPQRSTUVWXYZ]
r'[а-я]' # То же самое, что и [абвгдежзийклмнопрстуфхцчшщъыьэюя]
r'[А-Я]' # То же самое, что и [АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ]

# Можно получать неполный алфавит или не все цифры:
r'[4-7]' # То же самое, что и [4567]
r'[x-z]' # То же самое, что и [xyz]
r'[B-D]' # То же самое, что и [BCD]
r'[а-ж]' # То же самое, что и [абвгдеж]
r'[П-Т]' # То же самое, что и [ПРСТ]
r'[6-D]' # То же самое, что и [6789:;<=>?@ABCD]

# А также совмещать синтаксис:
r'[4-7qwerty]' # То же самое, что и [qwerty4567]
r'[23x-z1]'    # То же самое, что и [xyz123]
r'[B-DF]'      # То же самое, что и [BCDF]

# Чтобы использовать `-` как обычный символ - его достаточно экранировать или поставить в конец или начало скобок:
r'[4\-7]' # Найдёт 4, -, и 7
r'[-xz]'  # Найдёт -, x, и z
r'[^-xz]' # Найдёт всё, кроме -, x, и z
r'[BD-]'  # Найдёт B, D, и -
```

**Распространённая ошибка:** регулярное выражение `[21-47]` не найдёт числа от 21 до 47, оно будет равносильно выражению `[212347]`, так как диапазоны работают не с числами, а с цифрами.

##### Исключение с использованием диапазонов

```python
r'[^0-9]' # То же самое, что и [^0123456789]
r'[^a-z]' # То же самое, что и [^abcdefghijklmnopqrstuvwxyz]
r'[^A-Z]' # То же самое, что и [^ABCDEFGHIJKLMNOPQRSTUVWXYZ]
r'[^а-я]' # То же самое, что и [^абвгдежзийклмнопрстуфхцчшщъыьэюя]
r'[^А-Я]' # То же самое, что и [^АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ]

# Можно исключать неполный алфавит, или не все цифры:
r'[^4-7]' # То же самое, что и [^4567]
r'[^x-z]' # То же самое, что и [^xyz]
r'[^B-D]' # То же самое, что и [^BCD]
r'[^а-ж]' # То же самое, что и [^абвгдеж]
r'[^П-Т]' # То же самое, что и [^ПРСТ]
r'[^6-D]' # То же самое, что и [^6789:;<=>?@ABCD]

# Совмещать синтаксис
r'[^4-7qwerty]' # То же самое, что и [^qwerty4567]
r'[^23x-z1]'    # То же самое, что и [^xyz123]
r'[^B-DF]'      # То же самое, что и [^BCDF]
r'[^э-я1-3]' # То же самое, что и [^эюя123]
```

##### Экранирование квадратных скобок
```python
r'\[\]' # Найдет []
```

❗️**Шаблон [а-яА-Я]** не захватывает буквы ё и Ё. Если они вам понадобятся - придётся указывать их вручную: [а-яА-ЯёЁ].

## Шаблоны
| Шаблон | Соответствие                                                                                                                                         |
| ------ | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| `\n`   | Новая строка                                                                                                                                         |
| `.`    | Любой символ, кроме символа новой строки. Если `flags=re.DOTALL` - любой символ.                                                                     |
| `\s`   | Любой символ пробела, табуляции или новой строки.                                                                                                    |
| `\S`   | Любой символ, кроме пробела, табуляции или новой строки.                                                                                             |
| `\d`   | Любая цифра. Ищет все цифры: арабские, персидские, индийские, и так далее. Не эквивалентен `[0-9]`                                                   |
| `\D`   | Любой символ, кроме цифр.                                                                                                                            |
| `\w`   | Любая буква, цифра, или `_`. Шаблон не соответствует выражению `[a-zA-Z0-9_]`! Буквы используются не только латинские, туда входит множество языков. |
| `\W`   | Любой символ, кроме букв, цифр, и `_`.                                                                                                               |
| `\b`   | Промежуток между символом, совпадающим с \w,<br>и символом, не совпадающим с \w в любом порядке.                                                     |
| `\B`   | Промежуток между двумя символами,<br>совпадающими с \w или \W.                                                                                       |
| `\A`   | Начало всего текста                                                                                                                                  |
| `\Z`   | Конец всего текста                                                                                                                                   |
| `^`    | Начало всего текста или начало строчки текста, если `flags=re.MULTILINE`                                                                             |
| `$`    | Конец всего текста или конец строчки текста, если `flags=re.MULTILINE`                                                                               |
##### Вариации использования

Некоторые спецсимволы, например такие: `$^.-[]`, используются по-разному в регулярных выражениях в зависимости от контекста:
### `$`
```python
r'[A$Z]'  # Ищет символы A,$,Z
r'^text$' # Ищет text между началом и концом строки
r'100\$'  # Ищет 100$
```

### `^`
```python
r"[^abc]"      # Ищет любой символ, кроме a,b,c
r"^Some text$" # Ищет Some text между началом и концом строки
r"\^"          # Ищет символ ^ 
r"[a^bc]"      # Символ ^ не стоит первым в скобках, поэтому выражение ищет символы a,b,c,^
```

### `.`
```python
r'[A.Z]'     # Ищет символы A,.,Z
r'text.'     # Ищет text с любым символом, кроме перехода на новую строку
r'1\.000\$'  # Ищет 1.000$
```

### `-`
```python
r'Как-то так' # Ищет Как-то так
r'[+-]'       # Ищет символы +,-
r'[^-+]'      # Ищет любой символ, кроме +, -
r'[a-z]'      # Ищет все буквы латинского алфавита в нижнем регистре
r'[a\-z]'     # Ищет символы a,-,z
```

### `[]`
```python
r'[abc]'   # Ищет символы a,b,c
r'\[abc\]' # Ищет [abc]
r'[\[abc\]]' # Ищет символы [,a,b,c,]
```

##### Шаблоны и квадратные скобки

```python
r'[.]'  # Находит точку

r'[\d]' # То же самое, что и \d
```

## Квантификаторы

Квантификатор - конструкция, которая позволяет указывать количество повторений.

| Квантификатор | Использование                                        |
| ------------- | ---------------------------------------------------- |
| `{n}`         | Ровно n повторений                                   |
| `{m,n}`       | От m до n повторений.                                |
| `{m,}`        | Не менее m повторений                                |
| `{,n}`        | Не более n повторений                                |
| `?`           | Ноль или одно повторение<br><br>То же, что и `{0,1}` |
| `*`           | Ноль или более повторений<br><br>То же, что и `{0,}` |
| `+`           | Одно или более повторений<br><br>То же, что и `{1,}` |
```python
r'\d{3}' # ищет три подряд идущие цифры в строке
r'a?b' # ищет последовательности, где 'a' может быть ноль или один раз, а затем следует символ 'b'
r'[^\d\s]+' # ищет последовательности символов, которые не являются цифрами и не являются пробелами
r'[A-Za-z]+\d*'# ищет последовательности, начинающиеся с буквенной части, за которой может следовать числовая часть
r'\d{3,5}-[A-Z]{2,4}' # ищет последовательности от трех до пяти цифр, за которыми следует дефис, а затем последовательность от двух до четырех заглавных букв
```
- В каждом квантификаторе учитываются и начало, и конец отрезка.
- Каждый квантификатор по умолчанию - жадный. Жадные квантификаторы пытаются захватить как можно больше символов.
